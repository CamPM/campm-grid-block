<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Block Blast Master</title>
    <style>
        :root { --bg: #121212; --panel: #1e1e1e; --text: #ffffff; --accent: #4caf50; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: sans-serif; overflow: hidden; touch-action: none; }
        #ui-layer { position: absolute; width: 100%; padding: 10px; display: flex; justify-content: space-between; z-index: 10; pointer-events: none; }
        .btn { pointer-events: auto; background: var(--panel); border: 1px solid var(--accent); color: white; padding: 8px; border-radius: 5px; cursor: pointer; }
        #game-container { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        canvas { background: #2a2a2a; border-radius: 8px; max-width: 95vw; max-height: 70vh; }
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--panel); padding: 20px; border-radius: 10px; z-index: 100; width: 80%; text-align: center; }
        .active { display: block; }
        #shapes-container { display: flex; gap: 10px; margin-top: 20px; height: 100px; }
    </style>
</head>
<body>

<div id="ui-layer">
    <div>Score: <span id="score">0</span> | Best: <span id="best">0</span></div>
    <div>
        <button class="btn" onclick="toggleHelp()">?</button>
        <button class="btn" onclick="toggleMute()">ðŸ”Š</button>
        <button class="btn" id="fs-btn" onclick="goFullScreen()">â›¶</button>
    </div>
</div>

<div id="game-container">
    <canvas id="gameBoard"></canvas>
    <div id="shapes-container"></div>
</div>

<div id="gameOver" class="modal">
    <h1>Game Over!</h1>
    <p>Score: <span id="finalScore">0</span></p>
    <button class="btn" onclick="location.reload()">Retry</button>
</div>

<div id="helpModal" class="modal">
    <h3>Store & Help</h3>
    <p>Drag shapes to fill lines. Clear board to cycle themes.</p>
    <button class="btn" onclick="buyPowerUp('bomb')">Bomb (500 pts)</button>
    <button class="btn" onclick="buySkin('tetris')">Tetris Skin (1000 pts)</button>
    <button class="btn" onclick="toggleHelp()">Close</button>
</div>

<script>
    const canvas = document.getElementById('gameBoard');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const bestEl = document.getElementById('best');
    
    let config = { size: 8, cellSize: 40, score: 0, highscore: localStorage.getItem('blockHigh') || 0, muted: false };
    let grid = [];
    let themes = ['#2a2a2a', '#1a237e', '#311b92'];
    let currentTheme = 0;

    // Audio Context for beeps (No external files needed)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(freq, type) {
        if (config.muted) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.1);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 0.1);
    }

    function initGrid() {
        grid = Array(config.size).fill().map(() => Array(config.size).fill(0));
        canvas.width = config.size * config.cellSize;
        canvas.height = config.size * config.cellSize;
        drawGrid();
    }

    function drawGrid() {
        ctx.fillStyle = themes[currentTheme];
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        for (let r = 0; r < config.size; r++) {
            for (let c = 0; c < config.size; c++) {
                ctx.strokeStyle = "#444";
                ctx.strokeRect(c * config.cellSize, r * config.cellSize, config.cellSize, config.cellSize);
                if (grid[r][c]) {
                    ctx.fillStyle = config.skin || '#4caf50';
                    ctx.fillRect(c * config.cellSize + 2, r * config.cellSize + 2, config.cellSize - 4, config.cellSize - 4);
                }
            }
        }
    }

    function checkLines() {
        let linesCleared = 0;
        // Logic for rows/cols removal...
        // If lines cleared > 0, playSound(440, 'sine')
        // cycleTheme() if board cleared
    }

    function goFullScreen() {
        if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
    }

    function toggleMute() { config.muted = !config.muted; }
    function toggleHelp() { document.getElementById('helpModal').classList.toggle('active'); }

    // Logic for Touch Dragging would go here...
    
    window.onload = () => {
        bestEl.innerText = config.highscore;
        initGrid();
    };

</script>
</body>
</html>
